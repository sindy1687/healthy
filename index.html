<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤šé …å¥åº·ç´€éŒ„ç³»çµ± Prototype</title>
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', 'Microsoft JhengHei', Arial, sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0; 
      padding: 20px; 
      min-height: 100vh;
    }
    .container { 
      max-width: 1200px; 
      margin: 0 auto; 
      background: rgba(255, 255, 255, 0.95); 
      border-radius: 20px; 
      box-shadow: 0 20px 40px rgba(0,0,0,0.1); 
      padding: 40px; 
      backdrop-filter: blur(10px);
    }
    h1 { 
      text-align: center; 
      color: #2d3748; 
      font-size: 2.5em;
      margin-bottom: 30px;
      font-weight: 300;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .form-section {
      background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.05);
    }
    .form-title {
      font-size: 1.3em;
      color: #4a5568;
      margin-bottom: 20px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .form-title::before {
      content: "ğŸ“";
      font-size: 1.2em;
    }
    form { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px; 
      align-items: end;
    }
    .form-group { 
      display: flex; 
      flex-direction: column; 
    }
    .form-group.full-width {
      grid-column: 1 / -1;
    }
    label { 
      font-weight: 600; 
      margin-bottom: 8px; 
      color: #2d3748;
      font-size: 0.9em;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    input, select, textarea { 
      padding: 12px 16px; 
      border: 2px solid #e2e8f0; 
      border-radius: 10px; 
      font-size: 1em; 
      transition: all 0.3s ease;
      background: white;
    }
    input:focus, select:focus, textarea:focus { 
      outline: none; 
      border-color: #667eea; 
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      transform: translateY(-2px);
    }
    button { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      color: white; 
      border: none; 
      border-radius: 10px; 
      padding: 15px 30px; 
      font-size: 1em; 
      cursor: pointer; 
      transition: all 0.3s ease;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    button:hover { 
      transform: translateY(-2px); 
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }
    button:active { 
      transform: translateY(0); 
    }
    
    /* è§¸æ§å„ªåŒ– */
    @media (hover: none) and (pointer: coarse) {
      button:hover {
        transform: none;
        box-shadow: none;
      }
      button:active {
        transform: scale(0.98);
        box-shadow: 0 5px 10px rgba(102, 126, 234, 0.2);
      }
      .delete-btn:active {
        transform: scale(0.95);
      }
    }
    #printBtn { 
      background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
      margin-left: 0;
      margin-bottom: 0;
      white-space: nowrap;
    }
    #printBtn:hover {
      box-shadow: 0 10px 20px rgba(72, 187, 120, 0.3);
    }
    .export-buttons {
      float: right;
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .export-btn {
      background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
      padding: 12px 20px;
      font-size: 0.9em;
      white-space: nowrap;
    }
    .export-btn:hover {
      box-shadow: 0 10px 20px rgba(237, 137, 54, 0.3);
    }
    .export-btn.json {
      background: linear-gradient(135deg, #805ad5 0%, #6b46c1 100%);
    }
    .export-btn.json:hover {
      box-shadow: 0 10px 20px rgba(128, 90, 213, 0.3);
    }
    .import-btn {
      background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
      padding: 12px 20px;
      font-size: 0.9em;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }
    .import-btn:hover {
      box-shadow: 0 10px 20px rgba(66, 153, 225, 0.3);
    }
    .import-input {
      display: none;
    }
    .status { 
      font-size: 1.1em; 
      margin: 20px 0; 
      font-weight: 600; 
      padding: 15px;
      border-radius: 10px;
      text-align: center;
    }
    .table-section {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.05);
    }
    .table-title {
      font-size: 1.3em;
      color: #4a5568;
      margin-bottom: 20px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .table-title::before {
      content: "ğŸ“Š";
      font-size: 1.2em;
    }
    table { 
      width: 100%; 
      border-collapse: collapse; 
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }
    
    /* è¡¨æ ¼éŸ¿æ‡‰å¼å®¹å™¨ */
    .table-container {
      overflow-x: auto;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }
    th, td { 
      padding: 15px 12px; 
      text-align: center; 
      border-bottom: 1px solid #e2e8f0;
    }
    th { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      color: white;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-size: 0.9em;
    }
    tr:hover {
      background: #f7fafc;
    }
    .level-normal { 
      color: #38a169; 
      font-weight: 600;
    }
    .level-pre { 
      color: #d69e2e; 
      font-weight: 600;
    }
    .level-1 { 
      color: #e53e3e; 
      font-weight: 600;
    }
    .level-2 { 
      color: #c53030; 
      font-weight: 600;
    }
    .empty-message {
      text-align: center;
      color: #718096;
      font-style: italic;
      padding: 40px;
    }
    .delete-btn {
      background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      font-size: 0.8em;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .delete-btn:hover {
      box-shadow: 0 4px 8px rgba(229, 62, 62, 0.3);
      transform: translateY(-1px);
    }
    .clear-all-btn {
      background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 12px 20px;
      font-size: 0.9em;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-left: 0;
      white-space: nowrap;
    }
    .clear-all-btn:hover {
      box-shadow: 0 8px 16px rgba(229, 62, 62, 0.3);
    }
    .print-controls {
      display: flex;
      align-items: center;
      gap: 15px;
      margin: 50px 0 20px 0;
      padding: 20px;
      background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .print-controls label {
      font-weight: 600;
      color: #4a5568;
      margin: 0;
      text-transform: none;
      letter-spacing: normal;
    }
    .print-controls select,
    .print-controls input {
      padding: 8px 12px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 0.9em;
      background: white;
    }
    .print-controls select:focus,
    .print-controls input:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
    }
    .date-range {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .date-range input {
      width: 130px;
    }
    
    /* åˆ†é æ§åˆ¶é …æ¨£å¼ */
    .pagination-container {
      margin-top: 30px;
      text-align: center;
    }
    
    .pagination-info {
      margin-bottom: 15px;
      color: #4a5568;
      font-weight: 600;
      font-size: 0.9em;
    }
    
    .pagination-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .pagination-btn {
      background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
      color: #4a5568;
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 0.9em;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      min-width: 40px;
    }
    
    .pagination-btn:hover {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
    }
    
    .pagination-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
    }
    
    .pagination-ellipsis {
      color: #718096;
      font-weight: 600;
      padding: 0 8px;
    }
    /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 1024px) {
      .container { 
        padding: 30px; 
        margin: 10px;
      }
      form { 
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 15px;
      }
      .print-controls {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
      }
      .date-range {
        justify-content: center;
      }
    }
    
    @media (max-width: 768px) {
      body { 
        padding: 10px; 
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
      .container { 
        padding: 20px; 
        margin: 0;
        border-radius: 15px;
      }
      .container > div:first-child {
        flex-direction: column;
        gap: 15px;
        align-items: stretch;
      }
      .container > div:first-child h1 {
        text-align: center;
        font-size: 1.8em;
        margin-bottom: 0;
      }
      .container > div:first-child > div {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .container > div:first-child button {
        width: 100%;
        padding: 15px;
        font-size: 1em;
      }
      .form-section {
        padding: 20px;
        margin-bottom: 20px;
      }
      .form-title {
        font-size: 1.1em;
        margin-bottom: 15px;
      }
      form { 
        grid-template-columns: 1fr; 
        gap: 15px;
      }
      .form-group {
        margin-bottom: 10px;
      }
      input, select, textarea { 
        padding: 10px 12px; 
        font-size: 16px; /* é˜²æ­¢ iOS ç¸®æ”¾ */
      }
      button { 
        padding: 12px 20px; 
        font-size: 0.9em;
        width: 100%;
      }
      .table-section {
        padding: 20px;
      }
      .table-title {
        font-size: 1.1em;
        margin-bottom: 15px;
      }
      table { 
        font-size: 0.85em; 
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }
      th, td { 
        padding: 8px 6px; 
        min-width: 80px;
      }
      .export-buttons {
        float: none;
        justify-content: center;
        margin-bottom: 15px;
        flex-direction: column;
        gap: 8px;
      }
      .export-buttons > * {
        margin: 0;
        width: 100%;
        text-align: center;
      }
      .print-controls {
        margin: 30px 0 15px 0;
        padding: 15px;
      }
      .print-controls label {
        font-size: 0.9em;
      }
      .date-range {
        flex-direction: column;
        gap: 8px;
      }
      .date-range input {
        width: 100%;
      }
      .status {
        font-size: 1em;
        padding: 12px;
        margin: 15px 0;
      }
    }
    
    @media (max-width: 480px) {
      body { 
        padding: 5px; 
      }
      .container { 
        padding: 15px; 
      }
      h1 { 
        font-size: 1.5em; 
        margin-bottom: 15px;
      }
      .form-section {
        padding: 15px;
        margin-bottom: 15px;
      }
      .form-title {
        font-size: 1em;
        margin-bottom: 12px;
      }
      form { 
        gap: 12px; 
      }
      input, select, textarea { 
        padding: 8px 10px; 
        font-size: 16px;
      }
      button { 
        padding: 10px 16px; 
        font-size: 0.85em;
      }
      .table-section {
        padding: 15px;
      }
      table { 
        font-size: 0.8em; 
      }
      th, td { 
        padding: 6px 4px; 
        min-width: 70px;
      }
      .export-buttons {
        gap: 6px;
      }
      .export-btn, .import-btn, .clear-all-btn {
        padding: 10px 16px;
        font-size: 0.85em;
      }
      .print-controls {
        margin: 20px 0 10px 0;
        padding: 12px;
      }
      .status {
        font-size: 0.9em;
        padding: 10px;
        margin: 12px 0;
      }
      .delete-btn {
        padding: 4px 8px;
        font-size: 0.75em;
      }
      .pagination-container {
        margin-top: 20px;
      }
      .pagination-info {
        font-size: 0.8em;
        margin-bottom: 10px;
      }
      .pagination-controls {
        gap: 6px;
      }
      .pagination-btn {
        padding: 6px 10px;
        font-size: 0.8em;
        min-width: 35px;
      }
    }
    
    /* æ©«å‘æ‰‹æ©Ÿè¢å¹• */
    @media (max-width: 768px) and (orientation: landscape) {
      .container { 
        padding: 15px; 
      }
      h1 { 
        font-size: 1.6em; 
        margin-bottom: 15px;
      }
      .form-section {
        padding: 15px;
        margin-bottom: 15px;
      }
      form { 
        grid-template-columns: repeat(2, 1fr); 
        gap: 10px;
      }
      .form-group.full-width {
        grid-column: 1 / -1;
      }
      .export-buttons {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 6px;
      }
      .export-buttons > * {
        width: auto;
        flex: 1;
        min-width: 120px;
      }
    }
    
    /* å¹³æ¿æ©«å‘ */
    @media (min-width: 769px) and (max-width: 1024px) and (orientation: landscape) {
      form { 
        grid-template-columns: repeat(3, 1fr); 
      }
      .form-group.full-width {
        grid-column: 1 / -1;
      }
    }
    
    /* é«˜è§£æåº¦è¢å¹•å„ªåŒ– */
    @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
      .container {
        box-shadow: 0 20px 40px rgba(0,0,0,0.08);
      }
      .form-section, .table-section {
        box-shadow: 0 10px 25px rgba(0,0,0,0.03);
      }
      table {
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      }
    }
    
    /* å¤§è¢å¹•å„ªåŒ– */
    @media (min-width: 1200px) {
      .container {
        max-width: 1400px;
        padding: 50px;
      }
      form {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 25px;
      }
      .form-section {
        padding: 40px;
        margin-bottom: 40px;
      }
      .table-section {
        padding: 40px;
      }
      h1 {
        font-size: 3em;
        margin-bottom: 40px;
      }
    }
    @media print {
      body { background: white; }
      .container { box-shadow: none; padding: 0; }
      .form-section, #printBtn { display: none !important; }
      h1 { margin-top: 0; }
      table { box-shadow: none; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
      <h1 style="margin: 0;">ğŸ¥ å¤šé …å¥åº·ç´€éŒ„ç³»çµ±</h1>
      <div style="display: flex; gap: 10px;">
        <button onclick="openUserProfile()" style="background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%); padding: 12px 20px; font-size: 0.9em; white-space: nowrap;">
          ğŸ‘¤ ä½¿ç”¨è€…è³‡æ–™
        </button>
        <button onclick="openWeightManagement()" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); padding: 12px 20px; font-size: 0.9em; white-space: nowrap;">
          âš–ï¸ é«”é‡ç®¡ç†
        </button>
      </div>
    </div>
    
    <div class="form-section">
      <div class="form-title">â¤ï¸ è¡€å£“ç´€éŒ„</div>
      <form id="bpForm">
        <div class="form-group">
          <label for="bpDatetime">ğŸ“… æ—¥æœŸæ™‚é–“</label>
          <input type="datetime-local" id="bpDatetime" name="datetime" required>
        </div>
        <div class="form-group">
          <label for="bpTimePeriod">â° æ™‚æ®µ</label>
          <select id="bpTimePeriod" name="timePeriod" required>
            <option value="æ—©ä¸Š">ğŸŒ… æ—©ä¸Š</option>
            <option value="ä¸‹åˆ">ğŸŒ† ä¸‹åˆ</option>
          </select>
        </div>
        <div class="form-group">
          <label for="systolic">â¤ï¸ æ”¶ç¸®å£“ (mmHg)</label>
          <input type="number" id="systolic" name="systolic" min="50" max="250" placeholder="120" required>
        </div>
        <div class="form-group">
          <label for="diastolic">ğŸ’“ èˆ’å¼µå£“ (mmHg)</label>
          <input type="number" id="diastolic" name="diastolic" min="30" max="150" placeholder="80" required>
        </div>
        <div class="form-group">
          <label for="heartRate">ğŸ’— å¿ƒè·³ (bpm)</label>
          <input type="number" id="heartRate" name="heartRate" min="30" max="200" placeholder="75" required>
        </div>
        <div class="form-group full-width">
          <label for="bpNote">ğŸ“ å‚™è¨»</label>
          <textarea id="bpNote" name="note" rows="2" placeholder="ä¾‹å¦‚ï¼šé‹å‹•å¾Œæ¸¬é‡ã€å‰›èµ·åºŠã€ç”¨è—¥å¾Œ..."></textarea>
        </div>
        <div class="form-group full-width">
          <button type="submit">âœ… æ–°å¢è¡€å£“ç´€éŒ„</button>
        </div>
      </form>
    </div>

    <div class="form-section">
      <div class="form-title">ğŸ©¸ è¡€ç³–ç´€éŒ„</div>
      <form id="sugarForm">
        <div class="form-group">
          <label for="sugarDatetime">ğŸ“… æ—¥æœŸæ™‚é–“</label>
          <input type="datetime-local" id="sugarDatetime" name="datetime" required>
        </div>
        <div class="form-group">
          <label for="sugarTimePeriod">â° æ™‚æ®µ</label>
          <select id="sugarTimePeriod" name="timePeriod" required>
            <option value="æ—©ä¸Š">ğŸŒ… æ—©ä¸Š</option>
            <option value="ä¸‹åˆ">ğŸŒ† ä¸‹åˆ</option>
          </select>
        </div>
        <div class="form-group">
          <label for="bloodSugar">ğŸ©¸ è¡€ç³– (mg/dL)</label>
          <input type="number" id="bloodSugar" name="bloodSugar" min="40" max="400" placeholder="100" required>
        </div>
        <div class="form-group">
          <label for="sugarType">ğŸ½ï¸ è¡€ç³–æ™‚æ©Ÿ</label>
          <select id="sugarType" name="sugarType" required>
            <option value="é£¯å‰">ğŸ½ï¸ é£¯å‰</option>
            <option value="é£¯å¾Œ">ğŸ´ é£¯å¾Œ</option>
          </select>
        </div>
        <div class="form-group full-width">
          <label for="sugarNote">ğŸ“ å‚™è¨»</label>
          <textarea id="sugarNote" name="note" rows="2" placeholder="ä¾‹å¦‚ï¼šé‹å‹•å¾Œæ¸¬é‡ã€å‰›èµ·åºŠã€ç”¨è—¥å¾Œ..."></textarea>
        </div>
        <div class="form-group full-width">
          <button type="submit">âœ… æ–°å¢è¡€ç³–ç´€éŒ„</button>
        </div>
      </form>
    </div>

    <div class="form-section">
      <div class="form-title">âš–ï¸ é«”é‡ç´€éŒ„</div>
      <form id="weightForm">
        <div class="form-group">
          <label for="weightDatetime">ğŸ“… æ—¥æœŸæ™‚é–“</label>
          <input type="datetime-local" id="weightDatetime" name="datetime" required>
        </div>
        <div class="form-group">
          <label for="weightTimePeriod">â° æ™‚æ®µ</label>
          <select id="weightTimePeriod" name="timePeriod" required>
            <option value="æ—©ä¸Š">ğŸŒ… æ—©ä¸Š</option>
            <option value="ä¸‹åˆ">ğŸŒ† ä¸‹åˆ</option>
            <option value="æ™šä¸Š">ğŸŒ™ æ™šä¸Š</option>
          </select>
        </div>
        <div class="form-group">
          <label for="weight">âš–ï¸ é«”é‡ (kg)</label>
          <input type="number" id="weight" name="weight" min="20" max="200" step="0.1" placeholder="65.5" required>
        </div>
        <div class="form-group">
          <label for="bodyFat">ğŸ“Š é«”è„‚ç‡ (%)</label>
          <input type="number" id="bodyFat" name="bodyFat" min="5" max="50" step="0.1" placeholder="20.5">
        </div>
        <div class="form-group">
          <label for="muscleMass">ğŸ’ª è‚Œè‚‰é‡ (kg)</label>
          <input type="number" id="muscleMass" name="muscleMass" min="10" max="100" step="0.1" placeholder="45.0">
        </div>
        <div class="form-group">
          <label for="bmi">ğŸ“ BMI</label>
          <input type="number" id="bmi" name="bmi" min="10" max="50" step="0.1" placeholder="22.5" readonly>
        </div>
        <div class="form-group full-width">
          <label for="weightNote">ğŸ“ å‚™è¨»</label>
          <textarea id="weightNote" name="note" rows="2" placeholder="ä¾‹å¦‚ï¼šé‹å‹•å¾Œæ¸¬é‡ã€é£²é£Ÿèª¿æ•´å¾Œã€ç‰¹æ®Šæƒ…æ³..."></textarea>
        </div>
        <div class="form-group full-width">
          <button type="submit">âœ… æ–°å¢é«”é‡ç´€éŒ„</button>
        </div>
      </form>
    </div>

    <div class="status" id="statusMsg"></div>
    
    <div class="table-section">
      <div class="table-title">å¥åº·ç´€éŒ„ç¸½è¦½</div>
      <div class="export-buttons">
        <button class="export-btn" onclick="exportToCSV()">ğŸ“Š åŒ¯å‡º CSV</button>
        <button class="export-btn json" onclick="exportToJSON()">ğŸ’¾ åŒ¯å‡º JSON</button>
        <label class="import-btn" for="importInput">â¬†ï¸ åŒ¯å…¥ JSON
          <input id="importInput" class="import-input" type="file" accept="application/json" onchange="importFromJSON(event)">
        </label>
        <button id="printBtn" onclick="printSelectedRecords()">ğŸ–¨ï¸ åˆ—å°ç´€éŒ„è¡¨</button>
        <button class="clear-all-btn" onclick="clearAllRecords()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰ç´€éŒ„</button>
      </div>
      
      <div class="print-controls">
        <label>ğŸ“… åˆ—å°ç¯„åœï¼š</label>
        <select id="printRange" onchange="updateDateInputs()">
          <option value="today">ä»Šå¤©</option>
          <option value="7days">æœ€è¿‘7å¤©</option>
          <option value="30days">æœ€è¿‘30å¤©</option>
          <option value="custom">è‡ªè¨‚æ—¥æœŸç¯„åœ</option>
        </select>
        <div class="date-range" id="customDateRange" style="display:none;">
          <label>å¾ï¼š</label>
          <input type="date" id="startDate">
          <label>åˆ°ï¼š</label>
          <input type="date" id="endDate">
        </div>
      </div>
      <div class="table-container">
        <table id="recordTable">
                  <thead>
          <tr>
            <th>ğŸ“… æ—¥æœŸ</th>
            <th>â° æ™‚æ®µ</th>
            <th>ğŸ“Š é¡å‹</th>
            <th>â¤ï¸ æ”¶ç¸®å£“</th>
            <th>ğŸ’“ èˆ’å¼µå£“</th>
            <th>ğŸ’— å¿ƒè·³</th>
            <th>ğŸ©¸ è¡€ç³–</th>
            <th>ğŸ½ï¸ è¡€ç³–æ™‚æ©Ÿ</th>
            <th>âš–ï¸ é«”é‡</th>
            <th>ğŸ“Š é«”è„‚ç‡</th>
            <th>ğŸ’ª è‚Œè‚‰é‡</th>
            <th>ğŸ“ BMI</th>
            <th>ğŸ“Š åˆ†ç´š</th>
            <th>ğŸ“ å‚™è¨»</th>
            <th>âŒ æ“ä½œ</th>
          </tr>
        </thead>
                  <tbody>
          <tr>
            <td colspan="15" class="empty-message">å°šç„¡ç´€éŒ„ï¼Œè«‹æ–°å¢æ‚¨çš„ç¬¬ä¸€ç­†å¥åº·è³‡æ–™</td>
          </tr>
        </tbody>
        </table>
      </div>
      
      <!-- åˆ†é æ§åˆ¶é … -->
      <div id="pagination" class="pagination-container"></div>
    </div>
  </div>

  <script>
    // åˆ†ç´šåˆ¤æ–·é‚è¼¯
    function getBpLevel(s, d) {
      if (s === '' || d === '' || isNaN(s) || isNaN(d)) return null;
      if (s >= 160 || d >= 100) return { level: 'ğŸš¨ äºŒæœŸé«˜è¡€å£“', class: 'level-2' };
      if (s >= 140 || d >= 90) return { level: 'âš ï¸ ä¸€æœŸé«˜è¡€å£“', class: 'level-1' };
      if (s >= 120 || d >= 80) return { level: 'ğŸŒŸ é«˜è¡€å£“å‰æœŸ', class: 'level-pre' };
      return { level: 'ğŸ’š æ­£å¸¸', class: 'level-normal' };
    }
    function getSugarLevel(val, type) {
      if (!val || isNaN(val) || type !== 'é£¯å‰') return null;
      if (val >= 126) return { level: 'âš ï¸ è¡€ç³–éé«˜', class: 'level-1' };
      if (val >= 100) return { level: 'ğŸŒŸ è¡€ç³–åé«˜', class: 'level-pre' };
      if (val >= 70) return { level: 'ğŸ’š è¡€ç³–æ­£å¸¸', class: 'level-normal' };
      return { level: 'âš ï¸ è¡€ç³–éä½', class: 'level-2' };
    }
    
    function getBmiLevel(bmi) {
      if (!bmi || isNaN(bmi)) return null;
      if (bmi < 18.5) return { level: 'âš ï¸ é«”é‡éè¼•', class: 'level-2' };
      if (bmi < 24) return { level: 'ğŸ’š é«”é‡æ­£å¸¸', class: 'level-normal' };
      if (bmi < 27) return { level: 'ğŸŒŸ é«”é‡éé‡', class: 'level-pre' };
      if (bmi < 30) return { level: 'âš ï¸ è¼•åº¦è‚¥èƒ–', class: 'level-1' };
      if (bmi < 35) return { level: 'ğŸš¨ ä¸­åº¦è‚¥èƒ–', class: 'level-2' };
      return { level: 'ğŸš¨ é‡åº¦è‚¥èƒ–', class: 'level-2' };
    }

    // å–å¾— localStorage ç´€éŒ„
    function getRecords() {
      return JSON.parse(localStorage.getItem('bpRecords') || '[]');
    }
    // å„²å­˜åˆ° localStorage
    function saveRecords(records) {
      localStorage.setItem('bpRecords', JSON.stringify(records));
    }
    // åˆ†é è®Šæ•¸
    let currentPage = 1;
    const recordsPerPage = 20;
    
    // é¡¯ç¤ºè¡¨æ ¼
    function renderTable(page = 1) {
      const records = getRecords();
      const tbody = document.querySelector('#recordTable tbody');
      tbody.innerHTML = '';
      
      if (records.length === 0) {
        tbody.innerHTML = '<tr><td colspan="11" class="empty-message">å°šç„¡ç´€éŒ„ï¼Œè«‹æ–°å¢æ‚¨çš„ç¬¬ä¸€ç­†å¥åº·è³‡æ–™</td></tr>';
        renderPagination(0);
        return;
      }
      
      records.sort((a, b) => new Date(b.datetime) - new Date(a.datetime));
      
      // è¨ˆç®—åˆ†é 
      const totalPages = Math.ceil(records.length / recordsPerPage);
      const startIndex = (page - 1) * recordsPerPage;
      const endIndex = startIndex + recordsPerPage;
      const pageRecords = records.slice(startIndex, endIndex);
      
      // é¡¯ç¤ºç•¶å‰é é¢çš„ç´€éŒ„
      for (let i = 0; i < pageRecords.length; i++) {
        const rec = pageRecords[i];
        const actualIndex = startIndex + i; // å¯¦éš›åœ¨åŸå§‹é™£åˆ—ä¸­çš„ç´¢å¼•
        const d = new Date(rec.datetime);
        const dateStr = d.toLocaleDateString('zh-Hant', { year: 'numeric', month: '2-digit', day: '2-digit' });
        let levelStr = '';
        if (rec.bpLevel) levelStr += `<span class="${rec.bpLevel.class}">${rec.bpLevel.level}</span> `;
        if (rec.sugarLevel) levelStr += `<span class="${rec.sugarLevel.class}">${rec.sugarLevel.level}</span> `;
        if (rec.bmiLevel) levelStr += `<span class="${rec.bmiLevel.class}">${rec.bmiLevel.level}</span>`;
        tbody.innerHTML += `<tr>
          <td>${dateStr}</td>
          <td>${rec.timePeriod || ''}</td>
          <td>${rec.type === 'bloodPressure' ? 'â¤ï¸ è¡€å£“' : rec.type === 'bloodSugar' ? 'ğŸ©¸ è¡€ç³–' : 'âš–ï¸ é«”é‡'}</td>
          <td>${rec.systolic ?? ''}</td>
          <td>${rec.diastolic ?? ''}</td>
          <td>${rec.heartRate ?? ''}</td>
          <td>${rec.bloodSugar ?? ''}</td>
          <td>${rec.sugarType ?? ''}</td>
          <td>${rec.weight ?? ''}</td>
          <td>${rec.bodyFat ?? ''}</td>
          <td>${rec.muscleMass ?? ''}</td>
          <td>${rec.bmi ?? ''}</td>
          <td>${levelStr}</td>
          <td>${rec.note ? rec.note : ''}</td>
          <td><button class="delete-btn" onclick="deleteRecord(${actualIndex})">ğŸ—‘ï¸ åˆªé™¤</button></td>
        </tr>`;
      }
      
      // æ¸²æŸ“åˆ†é æ§åˆ¶é …
      renderPagination(records.length, page, totalPages);
    }
    
    // æ¸²æŸ“åˆ†é æ§åˆ¶é …
    function renderPagination(totalRecords, currentPage, totalPages) {
      const paginationContainer = document.getElementById('pagination');
      if (!paginationContainer) return;
      
      if (totalRecords === 0) {
        paginationContainer.innerHTML = '';
        return;
      }
      
      let paginationHTML = '<div class="pagination-info">';
      paginationHTML += `é¡¯ç¤ºç¬¬ ${(currentPage - 1) * recordsPerPage + 1} - ${Math.min(currentPage * recordsPerPage, totalRecords)} ç­†ï¼Œå…± ${totalRecords} ç­†ç´€éŒ„`;
      paginationHTML += '</div>';
      
      paginationHTML += '<div class="pagination-controls">';
      
      // ä¸Šä¸€é æŒ‰éˆ•
      if (currentPage > 1) {
        paginationHTML += `<button class="pagination-btn" onclick="changePage(${currentPage - 1})">â¬…ï¸ ä¸Šä¸€é </button>`;
      }
      
      // é ç¢¼æŒ‰éˆ•
      const startPage = Math.max(1, currentPage - 2);
      const endPage = Math.min(totalPages, currentPage + 2);
      
      if (startPage > 1) {
        paginationHTML += `<button class="pagination-btn" onclick="changePage(1)">1</button>`;
        if (startPage > 2) {
          paginationHTML += '<span class="pagination-ellipsis">...</span>';
        }
      }
      
      for (let i = startPage; i <= endPage; i++) {
        if (i === currentPage) {
          paginationHTML += `<button class="pagination-btn active">${i}</button>`;
        } else {
          paginationHTML += `<button class="pagination-btn" onclick="changePage(${i})">${i}</button>`;
        }
      }
      
      if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
          paginationHTML += '<span class="pagination-ellipsis">...</span>';
        }
        paginationHTML += `<button class="pagination-btn" onclick="changePage(${totalPages})">${totalPages}</button>`;
      }
      
      // ä¸‹ä¸€é æŒ‰éˆ•
      if (currentPage < totalPages) {
        paginationHTML += `<button class="pagination-btn" onclick="changePage(${currentPage + 1})">ä¸‹ä¸€é  â¡ï¸</button>`;
      }
      
      paginationHTML += '</div>';
      
      paginationContainer.innerHTML = paginationHTML;
    }
    
    // åˆ‡æ›é é¢
    function changePage(page) {
      currentPage = page;
      renderTable(page);
    }
    // è¡€å£“è¡¨å–®é€å‡º
    document.getElementById('bpForm').onsubmit = function(e) {
      e.preventDefault();
      const datetime = document.getElementById('bpDatetime').value;
      const timePeriod = document.getElementById('bpTimePeriod').value;
      const systolic = document.getElementById('systolic').value;
      const diastolic = document.getElementById('diastolic').value;
      const heartRate = document.getElementById('heartRate').value;
      const note = document.getElementById('bpNote').value.trim();
      
      if (!datetime) return;
      
      const bpLevel = getBpLevel(Number(systolic), Number(diastolic));
      
      // ç‹€æ…‹é¡¯ç¤º
      document.getElementById('statusMsg').innerHTML = `<span class="${bpLevel.class}">${bpLevel.level}</span>`;
      
      // æ–°å¢ç´€éŒ„
      const records = getRecords();
      records.push({
        datetime, 
        timePeriod,
        type: 'bloodPressure',
        systolic: Number(systolic),
        diastolic: Number(diastolic),
        heartRate: Number(heartRate),
        note,
        bpLevel
      });
      
      saveRecords(records);
      renderTable(currentPage);
      this.reset();
      document.getElementById('bpDatetime').value = new Date().toISOString().slice(0,16);
    };
    
    // è¡€ç³–è¡¨å–®é€å‡º
    document.getElementById('sugarForm').onsubmit = function(e) {
      e.preventDefault();
      const datetime = document.getElementById('sugarDatetime').value;
      const timePeriod = document.getElementById('sugarTimePeriod').value;
      const bloodSugar = document.getElementById('bloodSugar').value;
      const sugarType = document.getElementById('sugarType').value;
      const note = document.getElementById('sugarNote').value.trim();
      
      if (!datetime) return;
      
      const sugarLevel = getSugarLevel(Number(bloodSugar), sugarType);
      
      // ç‹€æ…‹é¡¯ç¤º
      if (sugarLevel) {
        document.getElementById('statusMsg').innerHTML = `<span class="${sugarLevel.class}">${sugarLevel.level}</span>`;
      } else {
        document.getElementById('statusMsg').innerHTML = '<span style="color:#718096">è¡€ç³–ç´€éŒ„å·²æ–°å¢</span>';
      }
      
      // æ–°å¢ç´€éŒ„
      const records = getRecords();
      records.push({
        datetime, 
        timePeriod,
        type: 'bloodSugar',
        bloodSugar: Number(bloodSugar),
        sugarType,
        note,
        sugarLevel
      });
      
      saveRecords(records);
      renderTable(currentPage);
      this.reset();
      document.getElementById('sugarDatetime').value = new Date().toISOString().slice(0,16);
    };
    
    // é«”é‡è¡¨å–®é€å‡º
    document.getElementById('weightForm').onsubmit = function(e) {
      e.preventDefault();
      const datetime = document.getElementById('weightDatetime').value;
      const timePeriod = document.getElementById('weightTimePeriod').value;
      const weight = document.getElementById('weight').value;
      const bodyFat = document.getElementById('bodyFat').value;
      const muscleMass = document.getElementById('muscleMass').value;
      const bmi = document.getElementById('bmi').value;
      const note = document.getElementById('weightNote').value.trim();
      
      if (!datetime) return;
      
      const bmiLevel = getBmiLevel(Number(bmi));
      
      // ç‹€æ…‹é¡¯ç¤º
      if (bmiLevel) {
        document.getElementById('statusMsg').innerHTML = `<span class="${bmiLevel.class}">${bmiLevel.level}</span>`;
      } else {
        document.getElementById('statusMsg').innerHTML = '<span style="color:#718096">é«”é‡ç´€éŒ„å·²æ–°å¢</span>';
      }
      
      // æ–°å¢ç´€éŒ„
      const records = getRecords();
      records.push({
        datetime, 
        timePeriod,
        type: 'weight',
        weight: Number(weight),
        bodyFat: bodyFat ? Number(bodyFat) : null,
        muscleMass: muscleMass ? Number(muscleMass) : null,
        bmi: bmi ? Number(bmi) : null,
        note,
        bmiLevel
      });
      
      saveRecords(records);
      renderTable(currentPage);
      this.reset();
      document.getElementById('weightDatetime').value = new Date().toISOString().slice(0,16);
    };

    // é–‹å•Ÿä½¿ç”¨è€…è³‡æ–™é é¢
    function openUserProfile() {
      window.open('user-profile.html', '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
    }
    
    // é–‹å•Ÿé«”é‡ç®¡ç†é é¢
    function openWeightManagement() {
      window.open('weight-management.html', '_blank', 'width=1000,height=700,scrollbars=yes,resizable=yes');
    }
    
    // BMI è‡ªå‹•è¨ˆç®—
    function calculateBMI() {
      const weight = document.getElementById('weight').value;
      const height = getUserHeight(); // å¾ä½¿ç”¨è€…è³‡æ–™å–å¾—èº«é«˜
      
      if (weight && height) {
        const bmi = (weight / Math.pow(height / 100, 2)).toFixed(1);
        document.getElementById('bmi').value = bmi;
      }
    }
    
    // å–å¾—ä½¿ç”¨è€…èº«é«˜
    function getUserHeight() {
      const profile = JSON.parse(localStorage.getItem('userProfile') || '{}');
      return profile.height ? Number(profile.height) : null;
    }
    
    // é é¢è¼‰å…¥æ™‚
    window.onload = function() {
      // é è¨­å¡«å…¥ç¾åœ¨æ™‚é–“
      document.getElementById('bpDatetime').value = new Date().toISOString().slice(0,16);
      document.getElementById('sugarDatetime').value = new Date().toISOString().slice(0,16);
      document.getElementById('weightDatetime').value = new Date().toISOString().slice(0,16);
      
      // æ·»åŠ é«”é‡è¼¸å…¥ç›£è½ï¼Œè‡ªå‹•è¨ˆç®— BMI
      document.getElementById('weight').addEventListener('input', calculateBMI);
      
      renderTable(currentPage);
    };

    // åŒ¯å‡º CSV åŠŸèƒ½
    function exportToCSV() {
      const records = getRecords();
      if (records.length === 0) {
        alert('å°šç„¡ç´€éŒ„å¯åŒ¯å‡º');
        return;
      }
      
      let csv = 'æ—¥æœŸ,æ™‚æ®µ,é¡å‹,æ”¶ç¸®å£“,èˆ’å¼µå£“,å¿ƒè·³,è¡€ç³–,è¡€ç³–æ™‚æ©Ÿ,é«”é‡,é«”è„‚ç‡,è‚Œè‚‰é‡,BMI,åˆ†ç´š,å‚™è¨»\n';
      
      records.sort((a, b) => new Date(b.datetime) - new Date(a.datetime));
      for (const rec of records) {
        const d = new Date(rec.datetime);
        const dateStr = d.toLocaleDateString('zh-Hant', { year: 'numeric', month: '2-digit', day: '2-digit' });
        let levelStr = '';
        if (rec.bpLevel) levelStr += rec.bpLevel.level + ' ';
        if (rec.sugarLevel) levelStr += rec.sugarLevel.level + ' ';
        if (rec.bmiLevel) levelStr += rec.bmiLevel.level;
        
        const typeStr = rec.type === 'bloodPressure' ? 'â¤ï¸ è¡€å£“' : rec.type === 'bloodSugar' ? 'ğŸ©¸ è¡€ç³–' : 'âš–ï¸ é«”é‡';
        
        csv += `"${dateStr}","${rec.timePeriod || ''}","${typeStr}","${rec.systolic || ''}","${rec.diastolic || ''}","${rec.heartRate || ''}","${rec.bloodSugar || ''}","${rec.sugarType || ''}","${rec.weight || ''}","${rec.bodyFat || ''}","${rec.muscleMass || ''}","${rec.bmi || ''}","${levelStr}","${rec.note || ''}"\n`;
      }
      
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `å¥åº·ç´€éŒ„_${new Date().toISOString().slice(0,10)}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
    
    // åŒ¯å‡º JSON åŠŸèƒ½
    function exportToJSON() {
      const records = getRecords();
      if (records.length === 0) {
        alert('å°šç„¡ç´€éŒ„å¯åŒ¯å‡º');
        return;
      }
      
      const dataStr = JSON.stringify(records, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `å¥åº·ç´€éŒ„_${new Date().toISOString().slice(0,10)}.json`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // åŒ¯å…¥ JSON åŠŸèƒ½
    function importFromJSON(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const imported = JSON.parse(e.target.result);
          if (!Array.isArray(imported)) throw new Error('æ ¼å¼éŒ¯èª¤');
          const records = getRecords();
          // åˆä½µè³‡æ–™ï¼ˆé¿å…é‡è¤‡: ä»¥ datetime+æ™‚æ®µ åˆ¤æ–·ï¼‰
          const key = r => `${r.datetime}_${r.timePeriod}`;
          const existMap = Object.fromEntries(records.map(r => [key(r), r]));
          for (const rec of imported) {
            if (!existMap[key(rec)]) records.push(rec);
          }
          saveRecords(records);
          renderTable(currentPage);
          document.getElementById('statusMsg').innerHTML = '<span style="color:#3182ce">âœ… åŒ¯å…¥æˆåŠŸï¼</span>';
        } catch {
          alert('åŒ¯å…¥å¤±æ•—ï¼Œè«‹ç¢ºèªæª”æ¡ˆæ ¼å¼æ­£ç¢ºï¼');
        }
        event.target.value = '';
      };
      reader.readAsText(file);
    }

    // åˆªé™¤å–®ç­†ç´€éŒ„
    function deleteRecord(index) {
      if (confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†ç´€éŒ„å—ï¼Ÿ')) {
        const records = getRecords();
        records.splice(index, 1);
        saveRecords(records);
        
        // æª¢æŸ¥æ˜¯å¦éœ€è¦èª¿æ•´ç•¶å‰é é¢
        const totalPages = Math.ceil(records.length / recordsPerPage);
        if (currentPage > totalPages && totalPages > 0) {
          currentPage = totalPages;
        }
        
        renderTable(currentPage);
        document.getElementById('statusMsg').innerHTML = '<span style="color:#e53e3e">ğŸ—‘ï¸ ç´€éŒ„å·²åˆªé™¤</span>';
      }
    }
    
    // æ¸…ç©ºæ‰€æœ‰ç´€éŒ„
    function clearAllRecords() {
      if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰ç´€éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
        localStorage.removeItem('bpRecords');
        currentPage = 1;
        renderTable(currentPage);
        document.getElementById('statusMsg').innerHTML = '<span style="color:#e53e3e">ğŸ—‘ï¸ æ‰€æœ‰ç´€éŒ„å·²æ¸…ç©º</span>';
      }
    }

    // æ›´æ–°æ—¥æœŸè¼¸å…¥æ¬„ä½é¡¯ç¤º
    function updateDateInputs() {
      const range = document.getElementById('printRange').value;
      const customRange = document.getElementById('customDateRange');
      const startDate = document.getElementById('startDate');
      const endDate = document.getElementById('endDate');
      
      if (range === 'custom') {
        customRange.style.display = 'flex';
        const today = new Date().toISOString().slice(0,10);
        startDate.value = today;
        endDate.value = today;
      } else {
        customRange.style.display = 'none';
      }
    }
    
    // å–å¾—é¸å®šç¯„åœçš„ç´€éŒ„
    function getFilteredRecords() {
      const records = getRecords();
      const range = document.getElementById('printRange').value;
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      let filtered = records;
      
      switch(range) {
        case 'today':
          filtered = records.filter(rec => {
            const recDate = new Date(rec.datetime);
            recDate.setHours(0, 0, 0, 0);
            return recDate.getTime() === today.getTime();
          });
          break;
        case '7days':
          const weekAgo = new Date(today);
          weekAgo.setDate(today.getDate() - 7);
          filtered = records.filter(rec => {
            const recDate = new Date(rec.datetime);
            return recDate >= weekAgo;
          });
          break;
        case '30days':
          const monthAgo = new Date(today);
          monthAgo.setDate(today.getDate() - 30);
          filtered = records.filter(rec => {
            const recDate = new Date(rec.datetime);
            return recDate >= monthAgo;
          });
          break;
        case 'custom':
          const startDate = new Date(document.getElementById('startDate').value);
          const endDate = new Date(document.getElementById('endDate').value);
          endDate.setHours(23, 59, 59, 999);
          filtered = records.filter(rec => {
            const recDate = new Date(rec.datetime);
            return recDate >= startDate && recDate <= endDate;
          });
          break;
      }
      
      return filtered.sort((a, b) => new Date(b.datetime) - new Date(a.datetime));
    }
    
    // åˆ—å°é¸å®šç¯„åœçš„ç´€éŒ„
    function printSelectedRecords() {
      const filteredRecords = getFilteredRecords();
      if (filteredRecords.length === 0) {
        alert('é¸å®šç¯„åœå…§æ²’æœ‰ç´€éŒ„å¯åˆ—å°');
        return;
      }
      
      // å»ºç«‹åˆ—å°è¦–çª—
      const printWindow = window.open('', '_blank');
      const range = document.getElementById('printRange').value;
      let rangeText = '';
      
      switch(range) {
        case 'today':
          rangeText = 'ä»Šå¤©';
          break;
        case '7days':
          rangeText = 'æœ€è¿‘7å¤©';
          break;
        case '30days':
          rangeText = 'æœ€è¿‘30å¤©';
          break;
        case 'custom':
          const startDate = document.getElementById('startDate').value;
          const endDate = document.getElementById('endDate').value;
          rangeText = `${startDate} è‡³ ${endDate}`;
          break;
      }
      
      printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>å¥åº·ç´€éŒ„è¡¨ - ${rangeText}</title>
          <style>
            body { font-family: 'Microsoft JhengHei', Arial, sans-serif; margin: 20px; }
            h1 { text-align: center; color: #2d3748; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
            th { background: #f7fafc; font-weight: bold; }
            .level-normal { color: #38a169; }
            .level-pre { color: #d69e2e; }
            .level-1 { color: #e53e3e; }
            .level-2 { color: #c53030; }
            @media print { body { margin: 0; } }
          </style>
        </head>
        <body>
          <h1>ğŸ¥ å¥åº·ç´€éŒ„è¡¨</h1>
          <p><strong>åˆ—å°ç¯„åœï¼š</strong>${rangeText}</p>
          <p><strong>åˆ—å°æ™‚é–“ï¼š</strong>${new Date().toLocaleString('zh-Hant')}</p>
          <table>
            <thead>
              <tr>
                <th>æ—¥æœŸ</th>
                <th>æ™‚æ®µ</th>
                <th>é¡å‹</th>
                <th>æ”¶ç¸®å£“</th>
                <th>èˆ’å¼µå£“</th>
                <th>å¿ƒè·³</th>
                <th>è¡€ç³–</th>
                <th>è¡€ç³–æ™‚æ©Ÿ</th>
                <th>é«”é‡</th>
                <th>é«”è„‚ç‡</th>
                <th>è‚Œè‚‰é‡</th>
                <th>BMI</th>
                <th>åˆ†ç´š</th>
                <th>å‚™è¨»</th>
              </tr>
            </thead>
            <tbody>
              ${filteredRecords.map(rec => {
                const d = new Date(rec.datetime);
                const dateStr = d.toLocaleDateString('zh-Hant', { year: 'numeric', month: '2-digit', day: '2-digit' });
                let levelStr = '';
                if (rec.bpLevel) levelStr += `<span class="${rec.bpLevel.class}">${rec.bpLevel.level}</span> `;
                if (rec.sugarLevel) levelStr += `<span class="${rec.sugarLevel.class}">${rec.sugarLevel.level}</span> `;
                if (rec.bmiLevel) levelStr += `<span class="${rec.bmiLevel.class}">${rec.bmiLevel.level}</span>`;
                const typeStr = rec.type === 'bloodPressure' ? 'â¤ï¸ è¡€å£“' : rec.type === 'bloodSugar' ? 'ğŸ©¸ è¡€ç³–' : 'âš–ï¸ é«”é‡';
                return `<tr>
                  <td>${dateStr}</td>
                  <td>${rec.timePeriod || ''}</td>
                  <td>${typeStr}</td>
                  <td>${rec.systolic ?? ''}</td>
                  <td>${rec.diastolic ?? ''}</td>
                  <td>${rec.heartRate ?? ''}</td>
                  <td>${rec.bloodSugar ?? ''}</td>
                  <td>${rec.sugarType ?? ''}</td>
                  <td>${rec.weight ?? ''}</td>
                  <td>${rec.bodyFat ?? ''}</td>
                  <td>${rec.muscleMass ?? ''}</td>
                  <td>${rec.bmi ?? ''}</td>
                  <td>${levelStr}</td>
                  <td>${rec.note ? rec.note : ''}</td>
                </tr>`;
              }).join('')}
            </tbody>
          </table>
        </body>
        </html>
      `);
      
      printWindow.document.close();
      printWindow.focus();
      setTimeout(() => printWindow.print(), 500);
    }
  </script>
</body>
</html> 
