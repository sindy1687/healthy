<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Â§öÈ†ÖÂÅ•Â∫∑Á¥ÄÈåÑÁ≥ªÁµ± Prototype</title>
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', 'Microsoft JhengHei', Arial, sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0; 
      padding: 20px; 
      min-height: 100vh;
    }
    .container { 
      max-width: 1200px; 
      margin: 0 auto; 
      background: rgba(255, 255, 255, 0.95); 
      border-radius: 20px; 
      box-shadow: 0 20px 40px rgba(0,0,0,0.1); 
      padding: 40px; 
      backdrop-filter: blur(10px);
    }
    h1 { 
      text-align: center; 
      color: #2d3748; 
      font-size: 2.5em;
      margin-bottom: 30px;
      font-weight: 300;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .form-section {
      background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.05);
    }
    .form-title {
      font-size: 1.3em;
      color: #4a5568;
      margin-bottom: 20px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .form-title::before {
      content: "üìù";
      font-size: 1.2em;
    }
    form { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px; 
      align-items: end;
    }
    .form-group { 
      display: flex; 
      flex-direction: column; 
    }
    .form-group.full-width {
      grid-column: 1 / -1;
    }
    label { 
      font-weight: 600; 
      margin-bottom: 8px; 
      color: #2d3748;
      font-size: 0.9em;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    input, select, textarea { 
      padding: 12px 16px; 
      border: 2px solid #e2e8f0; 
      border-radius: 10px; 
      font-size: 1em; 
      transition: all 0.3s ease;
      background: white;
    }
    input:focus, select:focus, textarea:focus { 
      outline: none; 
      border-color: #667eea; 
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      transform: translateY(-2px);
    }
    button { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      color: white; 
      border: none; 
      border-radius: 10px; 
      padding: 15px 30px; 
      font-size: 1em; 
      cursor: pointer; 
      transition: all 0.3s ease;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    button:hover { 
      transform: translateY(-2px); 
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }
    button:active { 
      transform: translateY(0); 
    }
    
    /* Ëß∏ÊéßÂÑ™Âåñ */
    @media (hover: none) and (pointer: coarse) {
      button:hover {
        transform: none;
        box-shadow: none;
      }
      button:active {
        transform: scale(0.98);
        box-shadow: 0 5px 10px rgba(102, 126, 234, 0.2);
      }
      .delete-btn:active {
        transform: scale(0.95);
      }
    }
    #printBtn { 
      background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
      margin-left: 0;
      margin-bottom: 0;
      white-space: nowrap;
    }
    #printBtn:hover {
      box-shadow: 0 10px 20px rgba(72, 187, 120, 0.3);
    }
    .export-buttons {
      float: right;
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .export-btn {
      background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
      padding: 12px 20px;
      font-size: 0.9em;
      white-space: nowrap;
    }
    .export-btn:hover {
      box-shadow: 0 10px 20px rgba(237, 137, 54, 0.3);
    }
    .export-btn.json {
      background: linear-gradient(135deg, #805ad5 0%, #6b46c1 100%);
    }
    .export-btn.json:hover {
      box-shadow: 0 10px 20px rgba(128, 90, 213, 0.3);
    }
    .import-btn {
      background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
      padding: 12px 20px;
      font-size: 0.9em;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }
    .import-btn:hover {
      box-shadow: 0 10px 20px rgba(66, 153, 225, 0.3);
    }
    .import-input {
      display: none;
    }
    .status { 
      font-size: 1.1em; 
      margin: 20px 0; 
      font-weight: 600; 
      padding: 15px;
      border-radius: 10px;
      text-align: center;
    }
    .table-section {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.05);
    }
    .table-title {
      font-size: 1.3em;
      color: #4a5568;
      margin-bottom: 20px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .table-title::before {
      content: "üìä";
      font-size: 1.2em;
    }
    table { 
      width: 100%; 
      border-collapse: collapse; 
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }
    
    /* Ë°®Ê†ºÈüøÊáâÂºèÂÆπÂô® */
    .table-container {
      overflow-x: auto;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }
    th, td { 
      padding: 15px 12px; 
      text-align: center; 
      border-bottom: 1px solid #e2e8f0;
    }
    th { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      color: white;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-size: 0.9em;
    }
    tr:hover {
      background: #f7fafc;
    }
    .level-normal { 
      color: #38a169; 
      font-weight: 600;
    }
    .level-pre { 
      color: #d69e2e; 
      font-weight: 600;
    }
    .level-1 { 
      color: #e53e3e; 
      font-weight: 600;
    }
    .level-2 { 
      color: #c53030; 
      font-weight: 600;
    }
    .empty-message {
      text-align: center;
      color: #718096;
      font-style: italic;
      padding: 40px;
    }
    .delete-btn {
      background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      font-size: 0.8em;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .delete-btn:hover {
      box-shadow: 0 4px 8px rgba(229, 62, 62, 0.3);
      transform: translateY(-1px);
    }
    .clear-all-btn {
      background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 12px 20px;
      font-size: 0.9em;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-left: 0;
      white-space: nowrap;
    }
    .clear-all-btn:hover {
      box-shadow: 0 8px 16px rgba(229, 62, 62, 0.3);
    }
    .print-controls {
      display: flex;
      align-items: center;
      gap: 15px;
      margin: 50px 0 20px 0;
      padding: 20px;
      background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .print-controls label {
      font-weight: 600;
      color: #4a5568;
      margin: 0;
      text-transform: none;
      letter-spacing: normal;
    }
    .print-controls select,
    .print-controls input {
      padding: 8px 12px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 0.9em;
      background: white;
    }
    .print-controls select:focus,
    .print-controls input:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
    }
    .date-range {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .date-range input {
      width: 130px;
    }
    
    /* ÂàÜÈ†ÅÊéßÂà∂È†ÖÊ®£Âºè */
    .pagination-container {
      margin-top: 30px;
      text-align: center;
    }
    
    .pagination-info {
      margin-bottom: 15px;
      color: #4a5568;
      font-weight: 600;
      font-size: 0.9em;
    }
    
    .pagination-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .pagination-btn {
      background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
      color: #4a5568;
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 0.9em;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      min-width: 40px;
    }
    
    .pagination-btn:hover {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
    }
    
    .pagination-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
    }
    
    .pagination-ellipsis {
      color: #718096;
      font-weight: 600;
      padding: 0 8px;
    }
    /* ÈüøÊáâÂºèË®≠Ë®à */
    @media (max-width: 1024px) {
      .container { 
        padding: 30px; 
        margin: 10px;
      }
      form { 
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 15px;
      }
      .print-controls {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
      }
      .date-range {
        justify-content: center;
      }
    }
    
    @media (max-width: 768px) {
      body { 
        padding: 10px; 
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
      .container { 
        padding: 20px; 
        margin: 0;
        border-radius: 15px;
      }
      .container > div:first-child {
        flex-direction: column;
        gap: 15px;
        align-items: stretch;
      }
      .container > div:first-child h1 {
        text-align: center;
        font-size: 1.8em;
        margin-bottom: 0;
      }
      .container > div:first-child > div {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .container > div:first-child button {
        width: 100%;
        padding: 15px;
        font-size: 1em;
      }
      .form-section {
        padding: 20px;
        margin-bottom: 20px;
      }
      .form-title {
        font-size: 1.1em;
        margin-bottom: 15px;
      }
      form { 
        grid-template-columns: 1fr; 
        gap: 15px;
      }
      .form-group {
        margin-bottom: 10px;
      }
      input, select, textarea { 
        padding: 10px 12px; 
        font-size: 16px; /* Èò≤Ê≠¢ iOS Á∏ÆÊîæ */
      }
      button { 
        padding: 12px 20px; 
        font-size: 0.9em;
        width: 100%;
      }
      .table-section {
        padding: 20px;
      }
      .table-title {
        font-size: 1.1em;
        margin-bottom: 15px;
      }
      table { 
        font-size: 0.85em; 
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }
      th, td { 
        padding: 8px 6px; 
        min-width: 80px;
      }
      .export-buttons {
        float: none;
        justify-content: center;
        margin-bottom: 15px;
        flex-direction: column;
        gap: 8px;
      }
      .export-buttons > * {
        margin: 0;
        width: 100%;
        text-align: center;
      }
      .print-controls {
        margin: 30px 0 15px 0;
        padding: 15px;
      }
      .print-controls label {
        font-size: 0.9em;
      }
      .date-range {
        flex-direction: column;
        gap: 8px;
      }
      .date-range input {
        width: 100%;
      }
      .status {
        font-size: 1em;
        padding: 12px;
        margin: 15px 0;
      }
    }
    
    @media (max-width: 480px) {
      body { 
        padding: 5px; 
      }
      .container { 
        padding: 15px; 
      }
      h1 { 
        font-size: 1.5em; 
        margin-bottom: 15px;
      }
      .form-section {
        padding: 15px;
        margin-bottom: 15px;
      }
      .form-title {
        font-size: 1em;
        margin-bottom: 12px;
      }
      form { 
        gap: 12px; 
      }
      input, select, textarea { 
        padding: 8px 10px; 
        font-size: 16px;
      }
      button { 
        padding: 10px 16px; 
        font-size: 0.85em;
      }
      .table-section {
        padding: 15px;
      }
      table { 
        font-size: 0.8em; 
      }
      th, td { 
        padding: 6px 4px; 
        min-width: 70px;
      }
      .export-buttons {
        gap: 6px;
      }
      .export-btn, .import-btn, .clear-all-btn {
        padding: 10px 16px;
        font-size: 0.85em;
      }
      .print-controls {
        margin: 20px 0 10px 0;
        padding: 12px;
      }
      .status {
        font-size: 0.9em;
        padding: 10px;
        margin: 12px 0;
      }
      .delete-btn {
        padding: 4px 8px;
        font-size: 0.75em;
      }
      .pagination-container {
        margin-top: 20px;
      }
      .pagination-info {
        font-size: 0.8em;
        margin-bottom: 10px;
      }
      .pagination-controls {
        gap: 6px;
      }
      .pagination-btn {
        padding: 6px 10px;
        font-size: 0.8em;
        min-width: 35px;
      }
    }
    
    /* Ê©´ÂêëÊâãÊ©üËû¢Âπï */
    @media (max-width: 768px) and (orientation: landscape) {
      .container { 
        padding: 15px; 
      }
      h1 { 
        font-size: 1.6em; 
        margin-bottom: 15px;
      }
      .form-section {
        padding: 15px;
        margin-bottom: 15px;
      }
      form { 
        grid-template-columns: repeat(2, 1fr); 
        gap: 10px;
      }
      .form-group.full-width {
        grid-column: 1 / -1;
      }
      .export-buttons {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 6px;
      }
      .export-buttons > * {
        width: auto;
        flex: 1;
        min-width: 120px;
      }
    }
    
    /* Âπ≥ÊùøÊ©´Âêë */
    @media (min-width: 769px) and (max-width: 1024px) and (orientation: landscape) {
      form { 
        grid-template-columns: repeat(3, 1fr); 
      }
      .form-group.full-width {
        grid-column: 1 / -1;
      }
    }
    
    /* È´òËß£ÊûêÂ∫¶Ëû¢ÂπïÂÑ™Âåñ */
    @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
      .container {
        box-shadow: 0 20px 40px rgba(0,0,0,0.08);
      }
      .form-section, .table-section {
        box-shadow: 0 10px 25px rgba(0,0,0,0.03);
      }
      table {
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      }
    }
    
    /* Â§ßËû¢ÂπïÂÑ™Âåñ */
    @media (min-width: 1200px) {
      .container {
        max-width: 1400px;
        padding: 50px;
      }
      form {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 25px;
      }
      .form-section {
        padding: 40px;
        margin-bottom: 40px;
      }
      .table-section {
        padding: 40px;
      }
      h1 {
        font-size: 3em;
        margin-bottom: 40px;
      }
    }
    @media print {
      body { background: white; }
      .container { box-shadow: none; padding: 0; }
      .form-section, #printBtn { display: none !important; }
      h1 { margin-top: 0; }
      table { box-shadow: none; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
      <h1 style="margin: 0;">üè• Â§öÈ†ÖÂÅ•Â∫∑Á¥ÄÈåÑÁ≥ªÁµ±</h1>
      <div style="display: flex; gap: 10px;">
        <button onclick="openUserProfile()" style="background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%); padding: 12px 20px; font-size: 0.9em; white-space: nowrap;">
          üë§ ‰ΩøÁî®ËÄÖË≥áÊñô
        </button>
        <button onclick="openWeightManagement()" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); padding: 12px 20px; font-size: 0.9em; white-space: nowrap;">
          ‚öñÔ∏è È´îÈáçÁÆ°ÁêÜ
        </button>
      </div>
    </div>
    
    <div class="form-section">
      <div class="form-title">‚ù§Ô∏è Ë°ÄÂ£ìÁ¥ÄÈåÑ</div>
      <form id="bpForm">
        <div class="form-group">
          <label for="bpDatetime">üìÖ Êó•ÊúüÊôÇÈñì</label>
          <input type="datetime-local" id="bpDatetime" name="datetime" required>
        </div>
        <div class="form-group">
          <label for="bpTimePeriod">‚è∞ ÊôÇÊÆµ</label>
          <select id="bpTimePeriod" name="timePeriod" required>
            <option value="Êó©‰∏ä">üåÖ Êó©‰∏ä</option>
            <option value="‰∏ãÂçà">üåÜ ‰∏ãÂçà</option>
          </select>
        </div>
        <div class="form-group">
          <label for="systolic">‚ù§Ô∏è Êî∂Á∏ÆÂ£ì (mmHg)</label>
          <input type="number" id="systolic" name="systolic" min="50" max="250" placeholder="120" required>
        </div>
        <div class="form-group">
          <label for="diastolic">üíì ËàíÂºµÂ£ì (mmHg)</label>
          <input type="number" id="diastolic" name="diastolic" min="30" max="150" placeholder="80" required>
        </div>
        <div class="form-group">
          <label for="heartRate">üíó ÂøÉË∑≥ (bpm)</label>
          <input type="number" id="heartRate" name="heartRate" min="30" max="200" placeholder="75" required>
        </div>
        <div class="form-group full-width">
          <label for="bpNote">üìù ÂÇôË®ª</label>
          <textarea id="bpNote" name="note" rows="2" placeholder="‰æãÂ¶ÇÔºöÈÅãÂãïÂæåÊ∏¨Èáè„ÄÅÂâõËµ∑Â∫ä„ÄÅÁî®Ëó•Âæå..."></textarea>
        </div>
        <div class="form-group full-width">
          <button type="submit">‚úÖ Êñ∞Â¢ûË°ÄÂ£ìÁ¥ÄÈåÑ</button>
        </div>
      </form>
    </div>

    <div class="form-section">
      <div class="form-title">ü©∏ Ë°ÄÁ≥ñÁ¥ÄÈåÑ</div>
      <form id="sugarForm">
        <div class="form-group">
          <label for="sugarDatetime">üìÖ Êó•ÊúüÊôÇÈñì</label>
          <input type="datetime-local" id="sugarDatetime" name="datetime" required>
        </div>
        <div class="form-group">
          <label for="sugarTimePeriod">‚è∞ ÊôÇÊÆµ</label>
          <select id="sugarTimePeriod" name="timePeriod" required>
            <option value="Êó©‰∏ä">üåÖ Êó©‰∏ä</option>
            <option value="‰∏ãÂçà">üåÜ ‰∏ãÂçà</option>
          </select>
        </div>
        <div class="form-group">
          <label for="bloodSugar">ü©∏ Ë°ÄÁ≥ñ (mg/dL)</label>
          <input type="number" id="bloodSugar" name="bloodSugar" min="40" max="400" placeholder="100" required>
        </div>
        <div class="form-group">
          <label for="sugarType">üçΩÔ∏è Ë°ÄÁ≥ñÊôÇÊ©ü</label>
          <select id="sugarType" name="sugarType" required>
            <option value="È£ØÂâç">üçΩÔ∏è È£ØÂâç</option>
            <option value="È£ØÂæå">üç¥ È£ØÂæå</option>
          </select>
        </div>
        <div class="form-group full-width">
          <label for="sugarNote">üìù ÂÇôË®ª</label>
          <textarea id="sugarNote" name="note" rows="2" placeholder="‰æãÂ¶ÇÔºöÈÅãÂãïÂæåÊ∏¨Èáè„ÄÅÂâõËµ∑Â∫ä„ÄÅÁî®Ëó•Âæå..."></textarea>
        </div>
        <div class="form-group full-width">
          <button type="submit">‚úÖ Êñ∞Â¢ûË°ÄÁ≥ñÁ¥ÄÈåÑ</button>
        </div>
      </form>
    </div>

    <div class="form-section">
      <div class="form-title">‚öñÔ∏è È´îÈáçÁ¥ÄÈåÑ</div>
      <form id="weightForm">
        <div class="form-group">
          <label for="weightDatetime">üìÖ Êó•ÊúüÊôÇÈñì</label>
          <input type="datetime-local" id="weightDatetime" name="datetime" required>
        </div>
        <div class="form-group">
          <label for="weightTimePeriod">‚è∞ ÊôÇÊÆµ</label>
          <select id="weightTimePeriod" name="timePeriod" required>
            <option value="Êó©‰∏ä">üåÖ Êó©‰∏ä</option>
            <option value="‰∏ãÂçà">üåÜ ‰∏ãÂçà</option>
            <option value="Êôö‰∏ä">üåô Êôö‰∏ä</option>
          </select>
        </div>
        <div class="form-group">
          <label for="weight">‚öñÔ∏è È´îÈáç (kg)</label>
          <input type="number" id="weight" name="weight" min="20" max="200" step="0.1" placeholder="65.5" required>
        </div>
        <div class="form-group">
          <label for="bodyFat">üìä È´îËÑÇÁéá (%)</label>
          <input type="number" id="bodyFat" name="bodyFat" min="5" max="50" step="0.1" placeholder="20.5">
        </div>
        <div class="form-group">
          <label for="muscleMass">üí™ ËÇåËÇâÈáè (kg)</label>
          <input type="number" id="muscleMass" name="muscleMass" min="10" max="100" step="0.1" placeholder="45.0">
        </div>
        <div class="form-group">
          <label for="bmi">üìè BMI</label>
          <input type="number" id="bmi" name="bmi" min="10" max="50" step="0.1" placeholder="22.5" readonly>
        </div>
        <div class="form-group full-width">
          <label for="weightNote">üìù ÂÇôË®ª</label>
          <textarea id="weightNote" name="note" rows="2" placeholder="‰æãÂ¶ÇÔºöÈÅãÂãïÂæåÊ∏¨Èáè„ÄÅÈ£≤È£üË™øÊï¥Âæå„ÄÅÁâπÊÆäÊÉÖÊ≥Å..."></textarea>
        </div>
        <div class="form-group full-width">
          <button type="submit">‚úÖ Êñ∞Â¢ûÈ´îÈáçÁ¥ÄÈåÑ</button>
        </div>
      </form>
    </div>

    <div class="status" id="statusMsg"></div>
    
    <div class="table-section">
      <div class="table-title">ÂÅ•Â∫∑Á¥ÄÈåÑÁ∏ΩË¶Ω</div>
      <div class="export-buttons">
        <button class="export-btn" onclick="exportToCSV()">üìä ÂåØÂá∫ CSV</button>
        <button class="export-btn json" onclick="exportToJSON()">üíæ ÂåØÂá∫ JSON</button>
        <label class="import-btn" for="importInput">‚¨ÜÔ∏è ÂåØÂÖ• JSON
          <input id="importInput" class="import-input" type="file" accept="application/json" onchange="importFromJSON(event)">
        </label>
        <button id="printBtn" onclick="printSelectedRecords()">üñ®Ô∏è ÂàóÂç∞Á¥ÄÈåÑË°®</button>
        <button class="clear-all-btn" onclick="clearAllRecords()">üóëÔ∏è Ê∏ÖÁ©∫ÊâÄÊúâÁ¥ÄÈåÑ</button>
      </div>
      
      <div class="print-controls">
        <label>üìÖ ÂàóÂç∞ÁØÑÂúçÔºö</label>
        <select id="printRange" onchange="updateDateInputs()">
          <option value="today">‰ªäÂ§©</option>
          <option value="7days">ÊúÄËøë7Â§©</option>
          <option value="30days">ÊúÄËøë30Â§©</option>
          <option value="custom">Ëá™Ë®ÇÊó•ÊúüÁØÑÂúç</option>
        </select>
        <div class="date-range" id="customDateRange" style="display:none;">
          <label>ÂæûÔºö</label>
          <input type="date" id="startDate">
          <label>Âà∞Ôºö</label>
          <input type="date" id="endDate">
        </div>
      </div>
      <div class="table-container">
        <table id="recordTable">
                  <thead>
          <tr>
            <th>üìÖ Êó•Êúü</th>
            <th>‚è∞ ÊôÇÊÆµ</th>
            <th>üìä È°ûÂûã</th>
            <th>‚ù§Ô∏è Êî∂Á∏ÆÂ£ì</th>
            <th>üíì ËàíÂºµÂ£ì</th>
            <th>üíó ÂøÉË∑≥</th>
            <th>ü©∏ Ë°ÄÁ≥ñ</th>
            <th>üçΩÔ∏è Ë°ÄÁ≥ñÊôÇÊ©ü</th>
            <th>‚öñÔ∏è È´îÈáç</th>
            <th>üìä È´îËÑÇÁéá</th>
            <th>üí™ ËÇåËÇâÈáè</th>
            <th>üìè BMI</th>
            <th>üìä ÂàÜÁ¥ö</th>
            <th>üìù ÂÇôË®ª</th>
            <th>‚ùå Êìç‰Ωú</th>
          </tr>
        </thead>
                  <tbody>
          <tr>
            <td colspan="15" class="empty-message">Â∞öÁÑ°Á¥ÄÈåÑÔºåË´ãÊñ∞Â¢ûÊÇ®ÁöÑÁ¨¨‰∏ÄÁ≠ÜÂÅ•Â∫∑Ë≥áÊñô</td>
          </tr>
        </tbody>
        </table>
      </div>
      
      <!-- ÂàÜÈ†ÅÊéßÂà∂È†Ö -->
      <div id="pagination" class="pagination-container"></div>
    </div>
  </div>

  <script>
    // ÂàÜÁ¥öÂà§Êñ∑ÈÇèËºØ
    function getBpLevel(s, d) {
      if (s === '' || d === '' || isNaN(s) || isNaN(d)) return null;
      if (s >= 160 || d >= 100) return { level: 'üö® ‰∫åÊúüÈ´òË°ÄÂ£ì', class: 'level-2' };
      if (s >= 140 || d >= 90) return { level: '‚ö†Ô∏è ‰∏ÄÊúüÈ´òË°ÄÂ£ì', class: 'level-1' };
      if (s >= 120 || d >= 80) return { level: 'üåü È´òË°ÄÂ£ìÂâçÊúü', class: 'level-pre' };
      return { level: 'üíö Ê≠£Â∏∏', class: 'level-normal' };
    }
    function getSugarLevel(val, type) {
      if (!val || isNaN(val) || type !== 'È£ØÂâç') return null;
      if (val >= 126) return { level: '‚ö†Ô∏è Ë°ÄÁ≥ñÈÅéÈ´ò', class: 'level-1' };
      if (val >= 100) return { level: 'üåü Ë°ÄÁ≥ñÂÅèÈ´ò', class: 'level-pre' };
      if (val >= 70) return { level: 'üíö Ë°ÄÁ≥ñÊ≠£Â∏∏', class: 'level-normal' };
      return { level: '‚ö†Ô∏è Ë°ÄÁ≥ñÈÅé‰Ωé', class: 'level-2' };
    }
    
    function getBmiLevel(bmi) {
      if (!bmi || isNaN(bmi)) return null;
      if (bmi < 18.5) return { level: '‚ö†Ô∏è È´îÈáçÈÅéËºï', class: 'level-2' };
      if (bmi < 24) return { level: 'üíö È´îÈáçÊ≠£Â∏∏', class: 'level-normal' };
      if (bmi < 27) return { level: 'üåü È´îÈáçÈÅéÈáç', class: 'level-pre' };
      if (bmi < 30) return { level: '‚ö†Ô∏è ËºïÂ∫¶ËÇ•ËÉñ', class: 'level-1' };
      if (bmi < 35) return { level: 'üö® ‰∏≠Â∫¶ËÇ•ËÉñ', class: 'level-2' };
      return { level: 'üö® ÈáçÂ∫¶ËÇ•ËÉñ', class: 'level-2' };
    }

    // ÂèñÂæó localStorage Á¥ÄÈåÑ
    function getRecords() {
      return JSON.parse(localStorage.getItem('bpRecords') || '[]');
    }
    // ÂÑ≤Â≠òÂà∞ localStorage
    function saveRecords(records) {
      localStorage.setItem('bpRecords', JSON.stringify(records));
    }
    // ÂàÜÈ†ÅËÆäÊï∏
    let currentPage = 1;
    const recordsPerPage = 20;
    
    // È°ØÁ§∫Ë°®Ê†º
    function renderTable(page = 1) {
      const records = getRecords();
      const tbody = document.querySelector('#recordTable tbody');
      tbody.innerHTML = '';
      
      if (records.length === 0) {
        tbody.innerHTML = '<tr><td colspan="11" class="empty-message">Â∞öÁÑ°Á¥ÄÈåÑÔºåË´ãÊñ∞Â¢ûÊÇ®ÁöÑÁ¨¨‰∏ÄÁ≠ÜÂÅ•Â∫∑Ë≥áÊñô</td></tr>';
        renderPagination(0);
        return;
      }
      
      records.sort((a, b) => new Date(b.datetime) - new Date(a.datetime));
      
      // Ë®àÁÆóÂàÜÈ†Å
      const totalPages = Math.ceil(records.length / recordsPerPage);
      const startIndex = (page - 1) * recordsPerPage;
      const endIndex = startIndex + recordsPerPage;
      const pageRecords = records.slice(startIndex, endIndex);
      
      // È°ØÁ§∫Áï∂ÂâçÈ†ÅÈù¢ÁöÑÁ¥ÄÈåÑ
      for (let i = 0; i < pageRecords.length; i++) {
        const rec = pageRecords[i];
        const actualIndex = startIndex + i; // ÂØ¶ÈöõÂú®ÂéüÂßãÈô£Âàó‰∏≠ÁöÑÁ¥¢Âºï
        const d = new Date(rec.datetime);
        const dateStr = d.toLocaleDateString('zh-Hant', { year: 'numeric', month: '2-digit', day: '2-digit' });
        let levelStr = '';
        if (rec.bpLevel) levelStr += `<span class="${rec.bpLevel.class}">${rec.bpLevel.level}</span> `;
        if (rec.sugarLevel) levelStr += `<span class="${rec.sugarLevel.class}">${rec.sugarLevel.level}</span> `;
        if (rec.bmiLevel) levelStr += `<span class="${rec.bmiLevel.class}">${rec.bmiLevel.level}</span>`;
        tbody.innerHTML += `<tr>
          <td>${dateStr}</td>
          <td>${rec.timePeriod || ''}</td>
          <td>${rec.type === 'bloodPressure' ? '‚ù§Ô∏è Ë°ÄÂ£ì' : rec.type === 'bloodSugar' ? 'ü©∏ Ë°ÄÁ≥ñ' : '‚öñÔ∏è È´îÈáç'}</td>
          <td>${rec.systolic ?? ''}</td>
          <td>${rec.diastolic ?? ''}</td>
          <td>${rec.heartRate ?? ''}</td>
          <td>${rec.bloodSugar ?? ''}</td>
          <td>${rec.sugarType ?? ''}</td>
          <td>${rec.weight ?? ''}</td>
          <td>${rec.bodyFat ?? ''}</td>
          <td>${rec.muscleMass ?? ''}</td>
          <td>${rec.bmi ?? ''}</td>
          <td>${levelStr}</td>
          <td>${rec.note ? rec.note : ''}</td>
          <td><button class="delete-btn" onclick="deleteRecord(${actualIndex})">üóëÔ∏è Âà™Èô§</button></td>
        </tr>`;
      }
      
      // Ê∏≤ÊüìÂàÜÈ†ÅÊéßÂà∂È†Ö
      renderPagination(records.length, page, totalPages);
    }
    
    // Ê∏≤ÊüìÂàÜÈ†ÅÊéßÂà∂È†Ö
    function renderPagination(totalRecords, currentPage, totalPages) {
      const paginationContainer = document.getElementById('pagination');
      if (!paginationContainer) return;
      
      if (totalRecords === 0) {
        paginationContainer.innerHTML = '';
        return;
      }
      
      let paginationHTML = '<div class="pagination-info">';
      paginationHTML += `È°ØÁ§∫Á¨¨ ${(currentPage - 1) * recordsPerPage + 1} - ${Math.min(currentPage * recordsPerPage, totalRecords)} Á≠ÜÔºåÂÖ± ${totalRecords} Á≠ÜÁ¥ÄÈåÑ`;
      paginationHTML += '</div>';
      
      paginationHTML += '<div class="pagination-controls">';
      
      // ‰∏ä‰∏ÄÈ†ÅÊåâÈàï
      if (currentPage > 1) {
        paginationHTML += `<button class="pagination-btn" onclick="changePage(${currentPage - 1})">‚¨ÖÔ∏è ‰∏ä‰∏ÄÈ†Å</button>`;
      }
      
      // È†ÅÁ¢ºÊåâÈàï
      const startPage = Math.max(1, currentPage - 2);
      const endPage = Math.min(totalPages, currentPage + 2);
      
      if (startPage > 1) {
        paginationHTML += `<button class="pagination-btn" onclick="changePage(1)">1</button>`;
        if (startPage > 2) {
          paginationHTML += '<span class="pagination-ellipsis">...</span>';
        }
      }
      
      for (let i = startPage; i <= endPage; i++) {
        if (i === currentPage) {
          paginationHTML += `<button class="pagination-btn active">${i}</button>`;
        } else {
          paginationHTML += `<button class="pagination-btn" onclick="changePage(${i})">${i}</button>`;
        }
      }
      
      if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
          paginationHTML += '<span class="pagination-ellipsis">...</span>';
        }
        paginationHTML += `<button class="pagination-btn" onclick="changePage(${totalPages})">${totalPages}</button>`;
      }
      
      // ‰∏ã‰∏ÄÈ†ÅÊåâÈàï
      if (currentPage < totalPages) {
        paginationHTML += `<button class="pagination-btn" onclick="changePage(${currentPage + 1})">‰∏ã‰∏ÄÈ†Å ‚û°Ô∏è</button>`;
      }
      
      paginationHTML += '</div>';
      
      paginationContainer.innerHTML = paginationHTML;
    }
    
    // ÂàáÊèõÈ†ÅÈù¢
    function changePage(page) {
      currentPage = page;
      renderTable(page);
    }
    // Ë°ÄÂ£ìË°®ÂñÆÈÄÅÂá∫
    document.getElementById('bpForm').onsubmit = function(e) {
      e.preventDefault();
      const datetime = document.getElementById('bpDatetime').value;
      const timePeriod = document.getElementById('bpTimePeriod').value;
      const systolic = document.getElementById('systolic').value;
      const diastolic = document.getElementById('diastolic').value;
      const heartRate = document.getElementById('heartRate').value;
      const note = document.getElementById('bpNote').value.trim();
      
      if (!datetime) return;
      
      const bpLevel = getBpLevel(Number(systolic), Number(diastolic));
      
      // ÁãÄÊÖãÈ°ØÁ§∫
      document.getElementById('statusMsg').innerHTML = `<span class="${bpLevel.class}">${bpLevel.level}</span>`;
      
      // Êñ∞Â¢ûÁ¥ÄÈåÑ
      const records = getRecords();
      records.push({
        datetime, 
        timePeriod,
        type: 'bloodPressure',
        systolic: Number(systolic),
        diastolic: Number(diastolic),
        heartRate: Number(heartRate),
        note,
        bpLevel
      });
      
      saveRecords(records);
      renderTable(currentPage);
      this.reset();
      document.getElementById('bpDatetime').value = new Date().toISOString().slice(0,16);
    };
    
    // Ë°ÄÁ≥ñË°®ÂñÆÈÄÅÂá∫
    document.getElementById('sugarForm').onsubmit = function(e) {
      e.preventDefault();
      const datetime = document.getElementById('sugarDatetime').value;
      const timePeriod = document.getElementById('sugarTimePeriod').value;
      const bloodSugar = document.getElementById('bloodSugar').value;
      const sugarType = document.getElementById('sugarType').value;
      const note = document.getElementById('sugarNote').value.trim();
      
      if (!datetime) return;
      
      const sugarLevel = getSugarLevel(Number(bloodSugar), sugarType);
      
      // ÁãÄÊÖãÈ°ØÁ§∫
      if (sugarLevel) {
        document.getElementById('statusMsg').innerHTML = `<span class="${sugarLevel.class}">${sugarLevel.level}</span>`;
      } else {
        document.getElementById('statusMsg').innerHTML = '<span style="color:#718096">Ë°ÄÁ≥ñÁ¥ÄÈåÑÂ∑≤Êñ∞Â¢û</span>';
      }
      
      // Êñ∞Â¢ûÁ¥ÄÈåÑ
      const records = getRecords();
      records.push({
        datetime, 
        timePeriod,
        type: 'bloodSugar',
        bloodSugar: Number(bloodSugar),
        sugarType,
        note,
        sugarLevel
      });
      
      saveRecords(records);
      renderTable(currentPage);
      this.reset();
      document.getElementById('sugarDatetime').value = new Date().toISOString().slice(0,16);
    };
    
    // È´îÈáçË°®ÂñÆÈÄÅÂá∫
    document.getElementById('weightForm').onsubmit = function(e) {
      e.preventDefault();
      const datetime = document.getElementById('weightDatetime').value;
      const timePeriod = document.getElementById('weightTimePeriod').value;
      const weight = document.getElementById('weight').value;
      const bodyFat = document.getElementById('bodyFat').value;
      const muscleMass = document.getElementById('muscleMass').value;
      const bmi = document.getElementById('bmi').value;
      const note = document.getElementById('weightNote').value.trim();
      
      if (!datetime) return;
      
      const bmiLevel = getBmiLevel(Number(bmi));
      
      // ÁãÄÊÖãÈ°ØÁ§∫
      if (bmiLevel) {
        document.getElementById('statusMsg').innerHTML = `<span class="${bmiLevel.class}">${bmiLevel.level}</span>`;
      } else {
        document.getElementById('statusMsg').innerHTML = '<span style="color:#718096">È´îÈáçÁ¥ÄÈåÑÂ∑≤Êñ∞Â¢û</span>';
      }
      
      // Êñ∞Â¢ûÁ¥ÄÈåÑ
      const records = getRecords();
      records.push({
        datetime, 
        timePeriod,
        type: 'weight',
        weight: Number(weight),
        bodyFat: bodyFat ? Number(bodyFat) : null,
        muscleMass: muscleMass ? Number(muscleMass) : null,
        bmi: bmi ? Number(bmi) : null,
        note,
        bmiLevel
      });
      
      saveRecords(records);
      renderTable(currentPage);
      this.reset();
      document.getElementById('weightDatetime').value = new Date().toISOString().slice(0,16);
    };

    // ÈñãÂïü‰ΩøÁî®ËÄÖË≥áÊñôÈ†ÅÈù¢
    function openUserProfile() {
      window.open('user-profile.html', '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
    }
    
    // ÈñãÂïüÈ´îÈáçÁÆ°ÁêÜÈ†ÅÈù¢
    function openWeightManagement() {
      window.open('weight-management.html', '_blank', 'width=1000,height=700,scrollbars=yes,resizable=yes');
    }
    
    // BMI Ëá™ÂãïË®àÁÆó
    function calculateBMI() {
      const weight = document.getElementById('weight').value;
      const height = getUserHeight(); // Âæû‰ΩøÁî®ËÄÖË≥áÊñôÂèñÂæóË∫´È´ò
      
      if (weight && height) {
        const bmi = (weight / Math.pow(height / 100, 2)).toFixed(1);
        document.getElementById('bmi').value = bmi;
      }
    }
    
    // ÂèñÂæó‰ΩøÁî®ËÄÖË∫´È´ò
    function getUserHeight() {
      const profile = JSON.parse(localStorage.getItem('userProfile') || '{}');
      return profile.height ? Number(profile.height) : null;
    }
    
    // È†ÅÈù¢ËºâÂÖ•ÊôÇ
    window.onload = function() {
      // È†êË®≠Â°´ÂÖ•ÁèæÂú®ÊôÇÈñì
      document.getElementById('bpDatetime').value = new Date().toISOString().slice(0,16);
      document.getElementById('sugarDatetime').value = new Date().toISOString().slice(0,16);
      document.getElementById('weightDatetime').value = new Date().toISOString().slice(0,16);
      
      // Ê∑ªÂä†È´îÈáçËº∏ÂÖ•Áõ£ËÅΩÔºåËá™ÂãïË®àÁÆó BMI
      document.getElementById('weight').addEventListener('input', calculateBMI);
      
      renderTable(currentPage);
    };

    // ÂåØÂá∫ CSV ÂäüËÉΩ
    function exportToCSV() {
      const records = getRecords();
      if (records.length === 0) {
        alert('Â∞öÁÑ°Á¥ÄÈåÑÂèØÂåØÂá∫');
        return;
      }
      
      let csv = 'Êó•Êúü,ÊôÇÊÆµ,È°ûÂûã,Êî∂Á∏ÆÂ£ì,ËàíÂºµÂ£ì,ÂøÉË∑≥,Ë°ÄÁ≥ñ,Ë°ÄÁ≥ñÊôÇÊ©ü,È´îÈáç,È´îËÑÇÁéá,ËÇåËÇâÈáè,BMI,ÂàÜÁ¥ö,ÂÇôË®ª\n';
      
      records.sort((a, b) => new Date(b.datetime) - new Date(a.datetime));
      for (const rec of records) {
        const d = new Date(rec.datetime);
        const dateStr = d.toLocaleDateString('zh-Hant', { year: 'numeric', month: '2-digit', day: '2-digit' });
        let levelStr = '';
        if (rec.bpLevel) levelStr += rec.bpLevel.level + ' ';
        if (rec.sugarLevel) levelStr += rec.sugarLevel.level + ' ';
        if (rec.bmiLevel) levelStr += rec.bmiLevel.level;
        
        const typeStr = rec.type === 'bloodPressure' ? '‚ù§Ô∏è Ë°ÄÂ£ì' : rec.type === 'bloodSugar' ? 'ü©∏ Ë°ÄÁ≥ñ' : '‚öñÔ∏è È´îÈáç';
        
        csv += `"${dateStr}","${rec.timePeriod || ''}","${typeStr}","${rec.systolic || ''}","${rec.diastolic || ''}","${rec.heartRate || ''}","${rec.bloodSugar || ''}","${rec.sugarType || ''}","${rec.weight || ''}","${rec.bodyFat || ''}","${rec.muscleMass || ''}","${rec.bmi || ''}","${levelStr}","${rec.note || ''}"\n`;
      }
      
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `ÂÅ•Â∫∑Á¥ÄÈåÑ_${new Date().toISOString().slice(0,10)}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
    
    // ÂåØÂá∫ JSON ÂäüËÉΩ
    function exportToJSON() {
      const records = getRecords();
      if (records.length === 0) {
        alert('Â∞öÁÑ°Á¥ÄÈåÑÂèØÂåØÂá∫');
        return;
      }
      
      const dataStr = JSON.stringify(records, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `ÂÅ•Â∫∑Á¥ÄÈåÑ_${new Date().toISOString().slice(0,10)}.json`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // ÂåØÂÖ• JSON ÂäüËÉΩ
    function importFromJSON(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const imported = JSON.parse(e.target.result);
          if (!Array.isArray(imported)) throw new Error('Ê†ºÂºèÈåØË™§');
          const records = getRecords();
          // Âêà‰ΩµË≥áÊñôÔºàÈÅøÂÖçÈáçË§á: ‰ª• datetime+ÊôÇÊÆµ Âà§Êñ∑Ôºâ
          const key = r => `${r.datetime}_${r.timePeriod}`;
          const existMap = Object.fromEntries(records.map(r => [key(r), r]));
          for (const rec of imported) {
            if (!existMap[key(rec)]) records.push(rec);
          }
          saveRecords(records);
          renderTable(currentPage);
          document.getElementById('statusMsg').innerHTML = '<span style="color:#3182ce">‚úÖ ÂåØÂÖ•ÊàêÂäüÔºÅ</span>';
        } catch {
          alert('ÂåØÂÖ•Â§±ÊïóÔºåË´ãÁ¢∫Ë™çÊ™îÊ°àÊ†ºÂºèÊ≠£Á¢∫ÔºÅ');
        }
        event.target.value = '';
      };
      reader.readAsText(file);
    }

    // Âà™Èô§ÂñÆÁ≠ÜÁ¥ÄÈåÑ
    function deleteRecord(index) {
      if (confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÁ≠ÜÁ¥ÄÈåÑÂóéÔºü')) {
        const records = getRecords();
        records.splice(index, 1);
        saveRecords(records);
        
        // Ê™¢Êü•ÊòØÂê¶ÈúÄË¶ÅË™øÊï¥Áï∂ÂâçÈ†ÅÈù¢
        const totalPages = Math.ceil(records.length / recordsPerPage);
        if (currentPage > totalPages && totalPages > 0) {
          currentPage = totalPages;
        }
        
        renderTable(currentPage);
        document.getElementById('statusMsg').innerHTML = '<span style="color:#e53e3e">üóëÔ∏è Á¥ÄÈåÑÂ∑≤Âà™Èô§</span>';
      }
    }
    
    // Ê∏ÖÁ©∫ÊâÄÊúâÁ¥ÄÈåÑ
    function clearAllRecords() {
      if (confirm('Á¢∫ÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÁ¥ÄÈåÑÂóéÔºüÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©ÂéüÔºÅ')) {
        localStorage.removeItem('bpRecords');
        currentPage = 1;
        renderTable(currentPage);
        document.getElementById('statusMsg').innerHTML = '<span style="color:#e53e3e">üóëÔ∏è ÊâÄÊúâÁ¥ÄÈåÑÂ∑≤Ê∏ÖÁ©∫</span>';
      }
    }

    // Êõ¥Êñ∞Êó•ÊúüËº∏ÂÖ•Ê¨Ñ‰ΩçÈ°ØÁ§∫
    function updateDateInputs() {
      const range = document.getElementById('printRange').value;
      const customRange = document.getElementById('customDateRange');
      const startDate = document.getElementById('startDate');
      const endDate = document.getElementById('endDate');
      
      if (range === 'custom') {
        customRange.style.display = 'flex';
        const today = new Date().toISOString().slice(0,10);
        startDate.value = today;
        endDate.value = today;
      } else {
        customRange.style.display = 'none';
      }
    }
    
    // ÂèñÂæóÈÅ∏ÂÆöÁØÑÂúçÁöÑÁ¥ÄÈåÑ
    function getFilteredRecords() {
      const records = getRecords();
      const range = document.getElementById('printRange').value;
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      let filtered = records;
      
      switch(range) {
        case 'today':
          filtered = records.filter(rec => {
            const recDate = new Date(rec.datetime);
            recDate.setHours(0, 0, 0, 0);
            return recDate.getTime() === today.getTime();
          });
          break;
        case '7days':
          const weekAgo = new Date(today);
          weekAgo.setDate(today.getDate() - 7);
          filtered = records.filter(rec => {
            const recDate = new Date(rec.datetime);
            return recDate >= weekAgo;
          });
          break;
        case '30days':
          const monthAgo = new Date(today);
          monthAgo.setDate(today.getDate() - 30);
          filtered = records.filter(rec => {
            const recDate = new Date(rec.datetime);
            return recDate >= monthAgo;
          });
          break;
        case 'custom':
          const startDate = new Date(document.getElementById('startDate').value);
          const endDate = new Date(document.getElementById('endDate').value);
          endDate.setHours(23, 59, 59, 999);
          filtered = records.filter(rec => {
            const recDate = new Date(rec.datetime);
            return recDate >= startDate && recDate <= endDate;
          });
          break;
      }
      
      return filtered.sort((a, b) => new Date(b.datetime) - new Date(a.datetime));
    }
    
    // ÂàóÂç∞ÈÅ∏ÂÆöÁØÑÂúçÁöÑÁ¥ÄÈåÑ
    function printSelectedRecords() {
      const filteredRecords = getFilteredRecords();
      if (filteredRecords.length === 0) {
        alert('ÈÅ∏ÂÆöÁØÑÂúçÂÖßÊ≤íÊúâÁ¥ÄÈåÑÂèØÂàóÂç∞');
        return;
      }
      
      // Âª∫Á´ãÂàóÂç∞Ë¶ñÁ™ó
      const printWindow = window.open('', '_blank');
      const range = document.getElementById('printRange').value;
      let rangeText = '';
      
      switch(range) {
        case 'today':
          rangeText = '‰ªäÂ§©';
          break;
        case '7days':
          rangeText = 'ÊúÄËøë7Â§©';
          break;
        case '30days':
          rangeText = 'ÊúÄËøë30Â§©';
          break;
        case 'custom':
          const startDate = document.getElementById('startDate').value;
          const endDate = document.getElementById('endDate').value;
          rangeText = `${startDate} Ëá≥ ${endDate}`;
          break;
      }
      
      printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>ÂÅ•Â∫∑Á¥ÄÈåÑË°® - ${rangeText}</title>
          <style>
            body { font-family: 'Microsoft JhengHei', Arial, sans-serif; margin: 20px; }
            h1 { text-align: center; color: #2d3748; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
            th { background: #f7fafc; font-weight: bold; }
            .level-normal { color: #38a169; }
            .level-pre { color: #d69e2e; }
            .level-1 { color: #e53e3e; }
            .level-2 { color: #c53030; }
            @media print { body { margin: 0; } }
          </style>
        </head>
        <body>
          <h1>üè• ÂÅ•Â∫∑Á¥ÄÈåÑË°®</h1>
          <p><strong>ÂàóÂç∞ÁØÑÂúçÔºö</strong>${rangeText}</p>
          <p><strong>ÂàóÂç∞ÊôÇÈñìÔºö</strong>${new Date().toLocaleString('zh-Hant')}</p>
          <table>
            <thead>
              <tr>
                <th>Êó•Êúü</th>
                <th>ÊôÇÊÆµ</th>
                <th>È°ûÂûã</th>
                <th>Êî∂Á∏ÆÂ£ì</th>
                <th>ËàíÂºµÂ£ì</th>
                <th>ÂøÉË∑≥</th>
                <th>Ë°ÄÁ≥ñ</th>
                <th>Ë°ÄÁ≥ñÊôÇÊ©ü</th>
                <th>È´îÈáç</th>
                <th>È´îËÑÇÁéá</th>
                <th>ËÇåËÇâÈáè</th>
                <th>BMI</th>
                <th>ÂàÜÁ¥ö</th>
                <th>ÂÇôË®ª</th>
              </tr>
            </thead>
            <tbody>
              ${filteredRecords.map(rec => {
                const d = new Date(rec.datetime);
                const dateStr = d.toLocaleDateString('zh-Hant', { year: 'numeric', month: '2-digit', day: '2-digit' });
                let levelStr = '';
                if (rec.bpLevel) levelStr += `<span class="${rec.bpLevel.class}">${rec.bpLevel.level}</span> `;
                if (rec.sugarLevel) levelStr += `<span class="${rec.sugarLevel.class}">${rec.sugarLevel.level}</span> `;
                if (rec.bmiLevel) levelStr += `<span class="${rec.bmiLevel.class}">${rec.bmiLevel.level}</span>`;
                const typeStr = rec.type === 'bloodPressure' ? '‚ù§Ô∏è Ë°ÄÂ£ì' : rec.type === 'bloodSugar' ? 'ü©∏ Ë°ÄÁ≥ñ' : '‚öñÔ∏è È´îÈáç';
                return `<tr>
                  <td>${dateStr}</td>
                  <td>${rec.timePeriod || ''}</td>
                  <td>${typeStr}</td>
                  <td>${rec.systolic ?? ''}</td>
                  <td>${rec.diastolic ?? ''}</td>
                  <td>${rec.heartRate ?? ''}</td>
                  <td>${rec.bloodSugar ?? ''}</td>
                  <td>${rec.sugarType ?? ''}</td>
                  <td>${rec.weight ?? ''}</td>
                  <td>${rec.bodyFat ?? ''}</td>
                  <td>${rec.muscleMass ?? ''}</td>
                  <td>${rec.bmi ?? ''}</td>
                  <td>${levelStr}</td>
                  <td>${rec.note ? rec.note : ''}</td>
                </tr>`;
              }).join('')}
            </tbody>
          </table>
        </body>
        </html>
      `);
      
      printWindow.document.close();
      printWindow.focus();
      setTimeout(() => printWindow.print(), 500);
    }
  </script>
</body>
</html> 
